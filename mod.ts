// import * as expressive from 'https://raw.githubusercontent.com/NMathar/deno-express/master/mod.ts'
import  { Application, Router, send } from 'https://deno.land/x/oak@v5.3.1/mod.ts';
import { mongoClient } from './db.ts';
import { oakCors } from "https://deno.land/x/cors/mod.ts";
import * as flags from "https://deno.land/std/flags/mod.ts";

import  UserClass,{User} from './models/portfolio.ts';

const {args} = Deno
const DEFAULT_PORT = 8000 ;
const argPort = flags.parse(args).port;
const PORT = argPort ? Number(argPort) : DEFAULT_PORT ;


console.log('MONGO DB CONNECTED!',mongoClient.listDatabases().then((item)=>console.log('item',item)));
console.log('Admin:=',mongoClient.database('local'))



const app = new Application();
const router = new Router();

const user = new UserClass()


const displayMsg =  `
t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░╬░░
t░████░░░░░░░██░░░╬░░░░░░░░░░░░████░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░█░░██░░░░░░█░░░░░░░░░░░░░╬░░██░░░██░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░╬░░░░░░░░░
t░░░█░█░░░░░░█░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░█░██░░░░░█░░░░░░░███░░░░░░░██████░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░╬░░
t░░░█░░██░░░░█░░░░░░██░██░░░░░░░░░░░██░░░░░░██░██░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░
t░░░█░░░██░░░█░░░░░██░░░█░░█░░░░╬░░░░█░░░░░██░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░█░░░░█░░░█░░░░█░░░░░░█░██░░░░░░░██░░░░█░░░░░░█░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░
t░░░█░░░░░██░█░░░██░████░██░██░░░░███░░░░██░████░██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░█░░░░░░███░░░█░░░░░░░░█░░█████░░░░░░░█░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░
t░░██░░░░░░░░█░░░█░░░░░░░░█░░░░░░░░░╬░░░░█░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░
t░░╬░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░╬░░░░░░░░░░░░░░░██░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░░░░░░░░██░█░░░░░░░░░░░░░░░░░░░╬░░░░░█░░░░░░░░░░░░░░░░╬░░░░░░░░╬░░░░░░
t░░░░░╬░░░░░░░░░░░░░░░░██░░██░░╬░░░░░░░░████░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░╬░░░░╬░░░░░░░██░░░░█░░░░░░░█████░░░█░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░╬░░░░░░░░░░░░░░░░██░░░░░██░░░█████░░░░░░░██░░░░░░█░░░░░░░░░░░╬░░░░░░░░░░░░░░░╬░░░░
t░░░░░░░░░░░░░░░░░░░██░████░░█░░░░░██░░░░░╬░░░██░░░░░█░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░
t░░░░░░░░░░╬░░░░░░░█░░░░░░░░░█░░░░░██░░░░░░░░███░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░██░░░░░░░░░░░█░░░░███████░░░█░░░░░░░█░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░
t░░░░╬░░░░░░░░░░░█░░░░░░░░░░░░░█░░░██░░░░████░░░░░░░░█░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░█░░██░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
t░░░░░░░╬░░░███░░░░░░░░░░░░╬░░░░░░░██░░░░░░╬░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░
t╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░
t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░DENO PROJECT - By Shahid ░░░░░░░░░░░░░░░╬░░░
t░░╬░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░
`

app.use(oakCors())
app.use(router.routes());


router.get('/',(ctx)=>{
    const res=ctx.response
    res.body = displayMsg.replaceAll('╬','*').replaceAll('t','\t\t\t\t\t\t\t')   
})


router.post('/create',async (ctx)=>{

    const value = await ctx.request.body();
    console.log('Value : ',value)
    const msg = await user.createUser(value.value)
    console.log('msg:',msg)
    if(msg==='success')  ctx.response.body = ({user :value.value,error:false})
    else ctx.response.body = {error:true}
    // ctx.response.body = "Created";
})

router.get('/all',async (ctx)=>{
    // const body = await ctx.request.body()
    // const users = await user.getAllUsers(JSON.parse(body.value).name)
    const users = await user.getAllUsers()
    // console.log("All Users",users)
    if(users)  ctx.response.body = {users} 
    else ctx.response.body = {error:true}
})

router.get('/singleUser/:userId',async (ctx)=>{
    // const body = await ctx.request.body();
    // const id:string = body.value.id;
    const id:string = ""+ ctx.params.userId;
    console.log('Single User ID:',typeof id," - ",id);
    const userDets = await user.getUser(id)
    // console.log('UserDets:',userDets)
    if(userDets.length) ctx.response.body={user:userDets[0],error:false}
    else ctx.response.body = {error:true}


})


// app.use((context:any)=>{
//     context.response.body = displayMsg.replaceAll('╬','*').replaceAll('t','\t\t\t\t\t\t\t')   
// })


app.use(async (context) => {
    await send(context, context.request.url.pathname, {
      root: `${Deno.cwd()}/public`,
      index: "index.html",
    });
  });
  

    app.listen({
        port:PORT
    });


// if(import.meta.main){
//     app.listen({
//         port:PORT
//     });
//     console.log('IM:',import.meta)    
// }






// // const app = new expressive.App();
// const app = new Application()
// app.

// app.use(expressive.simpleLog());
// app.use(expressive.static_('./public'))
// app.use(expressive.bodyParser.json());

// const displayMsg:string =  `
// t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░╬░░
// t░████░░░░░░░██░░░╬░░░░░░░░░░░░████░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░█░░██░░░░░░█░░░░░░░░░░░░░╬░░██░░░██░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░╬░░░░░░░░░
// t░░░█░█░░░░░░█░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░█░██░░░░░█░░░░░░░███░░░░░░░██████░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░╬░░
// t░░░█░░██░░░░█░░░░░░██░██░░░░░░░░░░░██░░░░░░██░██░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░
// t░░░█░░░██░░░█░░░░░██░░░█░░█░░░░╬░░░░█░░░░░██░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░█░░░░█░░░█░░░░█░░░░░░█░██░░░░░░░██░░░░█░░░░░░█░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░█░░░░░██░█░░░██░████░██░██░░░░███░░░░██░████░██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░█░░░░░░███░░░█░░░░░░░░█░░█████░░░░░░░█░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░
// t░░██░░░░░░░░█░░░█░░░░░░░░█░░░░░░░░░╬░░░░█░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░
// t░░╬░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░╬░░░░░░░░░░░░░░░██░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░░░░░░░░██░█░░░░░░░░░░░░░░░░░░░╬░░░░░█░░░░░░░░░░░░░░░░╬░░░░░░░░╬░░░░░░
// t░░░░░╬░░░░░░░░░░░░░░░░██░░██░░╬░░░░░░░░████░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░╬░░░░╬░░░░░░░██░░░░█░░░░░░░█████░░░█░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░╬░░░░░░░░░░░░░░░░██░░░░░██░░░█████░░░░░░░██░░░░░░█░░░░░░░░░░░╬░░░░░░░░░░░░░░░╬░░░░
// t░░░░░░░░░░░░░░░░░░░██░████░░█░░░░░██░░░░░╬░░░██░░░░░█░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░
// t░░░░░░░░░░╬░░░░░░░█░░░░░░░░░█░░░░░██░░░░░░░░███░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░██░░░░░░░░░░░█░░░░███████░░░█░░░░░░░█░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░
// t░░░░╬░░░░░░░░░░░█░░░░░░░░░░░░░█░░░██░░░░████░░░░░░░░█░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░█░░██░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
// t░░░░░░░╬░░░███░░░░░░░░░░░░╬░░░░░░░██░░░░░░╬░░░░░░░░███░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░
// t╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░
// t░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░DENO PROJECT - By Shahid ░░░░░░░░░░░░░░░╬░░░
// t░░╬░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░╬░░░░░░░░░░░░░░░░░░░░░
// `

// app.get('/sss', async (req,res)=>{
//     await res.json({msg:displayMsg})
// })
// // app.get('/all',  async(req,res)=>{
// app.get('/all',  async (req, res)=>{
//     // const data = user.getAllUsers();
//     // data.then((val:any)=>{
//     //     console.log("VALUE",val)
//     // })
//     // console.log('Data',data)
//     user.userCollection.find({name:'hi'}).then((data)=>{
//         const value = (data[0])
//        console.log(typeof data,'Data0:',value)
//        res
//         return res.json({data:value})
//     }).catch(err=>{
//         console.warn('$ERROR:',err);
//     }).finally(()=>{
//         console.log("finally")
//     })
   
// })
// app.post('/create', async (req, res)=>{
//     // const body = String.fromCharCode.apply(null, req.body)
//     // const body ={name: req.body.name}
//     // console.log('body ',req.data)
    
//     user.createUser(req.data)
//     return res.json({body:req.data});
// })


// const server = await app.listen(PORT);
// console.log('CONNECTED PORT',server.port)

